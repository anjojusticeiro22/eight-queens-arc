<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Teste Ethers</title>
</head>
<body>
<button id="mintBtn">Mint NFT</button>
<div id="status"></div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const mintBtn = document.getElementById('mintBtn');
    const status = document.getElementById('status');
    const CONTRACT_ADDRESS = "0xfb150a81805eD518582242a4C3bAcFf746C09215";
    const CONTRACT_ABI = ["function mintScore(string memory tokenURI) public returns (uint256)"];

    mintBtn.onclick = async () => {
        try {
            if(!window.ethereum){ alert("Instale MetaMask ou Rabby"); return; }

            // Coneccta carteira
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner();

            // Conecta contrato
            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

            const tokenURI = JSON.stringify({moves: 8, timestamp: Date.now()});

            status.textContent = "ğŸ“ Abrindo assinatura...";

            // Mint NFT
            const tx = await contract.mintScore(tokenURI, { gasLimit: 100000 });
            status.textContent = `ğŸ’³ TransaÃ§Ã£o enviada: ${tx.hash}`;

            const receipt = await tx.wait();
            status.textContent = `âœ… NFT mintado no bloco ${receipt.blockNumber}`;
        } catch(err){
            console.error(err);
            status.textContent = `âŒ Erro: ${err.message||err}`;
        }
    };
});
</script>
</body>
</html>
